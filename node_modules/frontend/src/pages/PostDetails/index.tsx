import { useQuery, useQueryClient } from "@tanstack/react-query";
import { useParams } from "react-router";
import postService from "../../api/postService";
import style from "./PostDetails.module.css";
import type { LikedPostsWithRelations } from "backend";

const PostDetails = () => {
  const queryClient = useQueryClient();
  const { communityId, postId } = useParams();
  const { data, isLoading, error } = useQuery({
    queryKey: ["post", postId],
    queryFn: () => postService.fetchPost(communityId!, postId!),
  });
  // const likePost = useMutation({
  //   mutationFn: postService.likePost,
  //   onMutate: async (newLikedPost: LikedPostsWithRelations) => {
  //     await queryClient.cancelQueries({queryKey: ['post', postId]})

  //     const previousPost = queryClient.getQueryData(['post', postId]);

  //   },
  // });

  if (isLoading) return <div>Loading...</div>;
  if (error) return <div>Error: {error.message}</div>;

  return (
    <div>
      <div>post details</div>
      <div>{data.fetchedPost.title}</div>
      <img src={data.fetchedPost.mediaUrl} alt="" width={300} height={300} />
      <div>{data.fetchedPost.content}</div>
      <div className={style[`like-dislike-container`]}>
        <div>
          <span className={`icon ${style["like-icon"]}`} />
          {data.fetchedPost.likes}
        </div>
        <div>
          <span className={`icon ${style["dislike-icon"]}`} />
          {data.fetchedPost.dislikes}
        </div>
      </div>
      <br />
    </div>
  );
};

export default PostDetails;
